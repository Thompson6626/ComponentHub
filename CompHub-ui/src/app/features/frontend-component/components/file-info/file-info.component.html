<!-- File Information -->
@let isOwnUser = isOwnUser$() | async;

@if (file$() | async; as file) {
  @switch (file.state) {
    @case (State.Loaded) {
      @if (file.data) {
        <div class="mt-6">
          <!-- Display file content as text if content is available -->
          @if (file.data.content) {
            <div class="relative mt-4 border border-gray-300 rounded-xl shadow-lg overflow-hidden">

              <!-- Header with Toggle Buttons -->
              <div class="flex justify-between items-center bg-gray-200 px-4 py-2 border-b border-gray-300">
                <span class="font-semibold text-gray-700">Preview</span>
                <div class="flex space-x-2">
                  <!-- Code Button -->
                  <button
                    class="flex items-center px-3 py-1 text-sm font-medium rounded-md transition"
                    [class.bg-blue-500]="isCodeView"
                    [class.text-white]="isCodeView"
                    [class.bg-gray-300]="!isCodeView"
                    [class.text-gray-700]="!isCodeView"
                    (click)="isCodeView = true"
                  >
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16 18l6-6m0 0l-6-6m6 6H2"></path>
                    </svg>
                    Code
                  </button>

                  <!-- Rendered Button -->
                  <button
                    class="flex items-center px-3 py-1 text-sm font-medium rounded-md transition"
                    [class.bg-blue-500]="!isCodeView"
                    [class.text-white]="!isCodeView"
                    [class.bg-gray-300]="isCodeView"
                    [class.text-gray-700]="isCodeView"
                    (click)="isCodeView = false"
                  >
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                    Rendered
                  </button>
                  @if (isOwnUser) {
                    <app-small-upload
                      [componentId]="componentId()"
                      (onFileUploaded)="refreshFile($event)"
                      [update]="true"
                    />
                    <button
                      class="flex items-center px-3 py-1 text-sm font-medium text-red-600 bg-gray-300 rounded-md transition hover:bg-red-500 hover:text-white"
                      (click)="deleteFile()"
                    >
                      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                      </svg>
                      Delete
                    </button>
                  }

                </div>
              </div>

              <!-- Code View -->
              @if (isCodeView) {
                <pre class="bg-gray-900 text-white text-sm p-4 rounded-b-xl overflow-auto transition-all">
                {{ file.data.content | Base64ToText }}
                </pre>
              }
              @else {
                <!-- Rendered View -->
                <div class="p-4 bg-gray-50 rounded-b-xl border-t border-gray-300 transition-all">
                  <div [innerHTML]="file.data.content | Base64ToText:true"></div>
                </div>
              }

            </div>
          }

        </div>
      } @else if (isOwnUser) {
        <app-upload
          [componentId]="componentId()"
          (onFileUploaded)="refreshFile($event)"
        />
      } @else {
        <div class="text-black w-full flex justify-center">
          No content to display
        </div>
      }
    }

    @case (State.Loading) {
      <div class="text-center py-6">
        <p-progress-spinner ariaLabel="Loading" />
      </div>
    }

    @case (State.Error) {
      <div class="text-black flex justify-center">
        Failed to get component's file
      </div>
    }
  }
}
